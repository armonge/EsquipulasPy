DROP VIEW IF EXISTS `vw_articulosconcostosactuales`;
CREATE OR REPLACE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `vw_articulosconcostosactuales` AS select `a`.`idarticulo` AS `idarticulo`,concat(`c`.`nombre`,' ',`sc`.`nombre`,' ',`m`.`nombre`) AS `Descripcion`,sum(if((`ca`.`idtipocosto` = 3),`ca`.`valorcosto`,0)) AS `DAI`,sum(if((`ca`.`idtipocosto` = 2),`ca`.`valorcosto`,0)) AS `ISC`,sum(if((`ca`.`idtipocosto` = 7),`ca`.`valorcosto`,0)) AS `Comisión` from (((((`articulos` `a` join `marca` `m` on((`m`.`idmarca` = `a`.`idmarca`))) join `categoria` `sc` on((`sc`.`idcategoria` = `a`.`idcategoria`))) join `categoria` `c` on((`c`.`idcategoria` = `sc`.`padre`))) join `costoagregadoarticulo` `caa` on((`caa`.`idarticulo` = `a`.`idarticulo`))) join `costoagregado` `ca` on((`ca`.`idcostoagregado` = `caa`.`idcostoagregado`))) where (`ca`.`activo` = 1) group by `a`.`idarticulo`;